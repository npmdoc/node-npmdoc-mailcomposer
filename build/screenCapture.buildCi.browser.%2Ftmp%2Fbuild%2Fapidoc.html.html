<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/andris9/mailcomposer#readme">mailcomposer (v4.0.2)</a>
</h1>
<h4>Compose E-Mail messages</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer">module mailcomposer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.mailcomposer">
            function <span class="apidocSignatureSpan"></span>mailcomposer
            <span class="apidocSignatureSpan">(mail)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.Gruntfile">
            function <span class="apidocSignatureSpan">mailcomposer.</span>Gruntfile
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer
            <span class="apidocSignatureSpan">(mail)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createAlternative
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createContentNode
            <span class="apidocSignatureSpan">(parentNode, element)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createMixed
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createRelated
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._processDataUrl
            <span class="apidocSignatureSpan">(element)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.compile">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.compile
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.getAlternatives
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.getAttachments
            <span class="apidocSignatureSpan">(findRelated)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.toString">
            function <span class="apidocSignatureSpan">mailcomposer.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.Gruntfile">module mailcomposer.Gruntfile</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.Gruntfile.Gruntfile">
            function <span class="apidocSignatureSpan">mailcomposer.</span>Gruntfile
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer">module mailcomposer.MailComposer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.MailComposer">
            function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer
            <span class="apidocSignatureSpan">(mail)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype">module mailcomposer.MailComposer.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createAlternative
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createContentNode
            <span class="apidocSignatureSpan">(parentNode, element)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createMixed
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createRelated
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_processDataUrl
            <span class="apidocSignatureSpan">(element)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.compile">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>compile
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAlternatives
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAttachments
            <span class="apidocSignatureSpan">(findRelated)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createAlternative">module mailcomposer.MailComposer.prototype._createAlternative</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative._createAlternative">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createAlternative
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createContentNode">module mailcomposer.MailComposer.prototype._createContentNode</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode._createContentNode">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createContentNode
            <span class="apidocSignatureSpan">(parentNode, element)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createMixed">module mailcomposer.MailComposer.prototype._createMixed</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed._createMixed">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createMixed
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createRelated">module mailcomposer.MailComposer.prototype._createRelated</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated._createRelated">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createRelated
            <span class="apidocSignatureSpan">(parentNode)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype._processDataUrl">module mailcomposer.MailComposer.prototype._processDataUrl</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl._processDataUrl">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_processDataUrl
            <span class="apidocSignatureSpan">(element)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype.compile">module mailcomposer.MailComposer.prototype.compile</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.compile.compile">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>compile
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype.getAlternatives">module mailcomposer.MailComposer.prototype.getAlternatives</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives.getAlternatives">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAlternatives
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.MailComposer.prototype.getAttachments">module mailcomposer.MailComposer.prototype.getAttachments</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments.getAttachments">
            function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAttachments
            <span class="apidocSignatureSpan">(findRelated)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.mailcomposer.toString">module mailcomposer.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.mailcomposer.toString.toString">
            function <span class="apidocSignatureSpan">mailcomposer.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer" id="apidoc.module.mailcomposer">module mailcomposer</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.mailcomposer" id="apidoc.element.mailcomposer.mailcomposer">
        function <span class="apidocSignatureSpan"></span>mailcomposer
        <span class="apidocSignatureSpan">(mail)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">mailcomposer = function (mail) {
    return new MailComposer(mail).compile();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.Gruntfile" id="apidoc.element.mailcomposer.Gruntfile">
        function <span class="apidocSignatureSpan">mailcomposer.</span>Gruntfile
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Gruntfile = function (grunt) {

    // Project configuration.
    grunt.initConfig({
        eslint: {
            all: ['lib/*.js', 'test/*.js', 'Gruntfile.js']
        },

        mochaTest: {
            all: {
                options: {
                    reporter: 'spec'
                },
                src: ['test/*-test.js']
            }
        }
    });

    // Load the plugin(s)
    grunt.loadNpmTasks('grunt-eslint');
    grunt.loadNpmTasks('grunt-mocha-test');

    // Tasks
    grunt.registerTask('default', ['eslint', 'mochaTest']);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer" id="apidoc.element.mailcomposer.MailComposer">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer
        <span class="apidocSignatureSpan">(mail)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MailComposer(mail) {
    if (!(this instanceof MailComposer)) {
        return new MailComposer(mail);
    }

    this.mail = mail || {};
    this.message = false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative" id="apidoc.element.mailcomposer.MailComposer.prototype._createAlternative">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createAlternative
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype._createAlternative = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/alternative', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/alternative', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._alternatives.forEach(function (alternative) {
        if (this._useRelated &amp;&amp; this._htmlNode === alternative) {
            this._createRelated(node);
        } else {
            this._createContentNode(node, alternative);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode" id="apidoc.element.mailcomposer.MailComposer.prototype._createContentNode">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createContentNode
        <span class="apidocSignatureSpan">(parentNode, element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype._createContentNode = function (parentNode, element) {
    element = element || {};
    element.content = element.content || '';

    var node;
    var encoding = (element.encoding || 'utf8')
        .toString()
        .toLowerCase()
        .replace(/[-_\s]/g, '');

    if (!parentNode) {
        node = new BuildMail(element.contentType, {
            filename: element.filename,
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild(element.contentType, {
            filename: element.filename,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    // add custom headers
    if (element.headers) {
        node.addHeader(element.headers);
    }

    if (element.cid) {
        node.setHeader('Content-Id', '&lt;' + element.cid.replace(/[&lt;&gt;]/g, '') + '&gt;');
    }

    if (element.contentTransferEncoding) {
        node.setHeader('Content-Transfer-Encoding', element.contentTransferEncoding);
    } else if (this.mail.encoding &amp;&amp; /^text\//i.test(element.contentType)) {
        node.setHeader('Content-Transfer-Encoding', this.mail.encoding);
    }

    if (!/^text\//i.test(element.contentType) || element.contentDisposition) {
        node.setHeader('Content-Disposition', element.contentDisposition || (element.cid ? 'inline' : 'attachment'));
    }

    if (typeof element.content === 'string' &amp;&amp; ['utf8', 'usascii', 'ascii'].indexOf(encoding) &lt; 0) {
        element.content = new Buffer(element.content, encoding);
    }

    // prefer pregenerated raw content
    if (element.raw) {
        node.setRaw(element.raw);
    } else {
        node.setContent(element.content);
    }

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed" id="apidoc.element.mailcomposer.MailComposer.prototype._createMixed">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createMixed
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype._createMixed = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/mixed', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/mixed', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    if (this._useAlternative) {
        this._createAlternative(node);
    } else if (this._useRelated) {
        this._createRelated(node);
    }

    [].concat(!this._useAlternative &amp;&amp; this._alternatives || []).concat(this._attachments.attached || []).forEach(function (element
) {
        // if the element is a html node from related subpart then ignore it
        if (!this._useRelated || element !== this._htmlNode) {
            this._createContentNode(node, element);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated" id="apidoc.element.mailcomposer.MailComposer.prototype._createRelated">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._createRelated
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype._createRelated = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/related; type="text/html"', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/related; type="text/html"', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._createContentNode(node, this._htmlNode);

    this._attachments.related.forEach(function (alternative) {
        this._createContentNode(node, alternative);
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl" id="apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype._processDataUrl
        <span class="apidocSignatureSpan">(element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype._processDataUrl = function (element) {
    var parts = (element.path || element.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);
    if (!parts) {
        return element;
    }

    element.content = /\bbase64$/i.test(parts[1]) ? new Buffer(parts[2], 'base64') : new Buffer(decodeURIComponent(parts[2]));

    if ('path' in element) {
        element.path = false;
    }

    if ('href' in element) {
        element.href = false;
    }

    parts[1].split(';').forEach(function (item) {
        if (/^\w+\/[^\/]+$/i.test(item)) {
            element.contentType = element.contentType || item.toLowerCase();
        }
    });

    return element;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.compile" id="apidoc.element.mailcomposer.MailComposer.prototype.compile">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.compile
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype.compile = function () {
    this._alternatives = this.getAlternatives();
    this._htmlNode = this._alternatives.filter(function (alternative) {
        return /^text\/html\b/i.test(alternative.contentType);
    }).pop();
    this._attachments = this.getAttachments(!!this._htmlNode);

    this._useRelated = !!(this._htmlNode &amp;&amp; this._attachments.related.length);
    this._useAlternative = this._alternatives.length &gt; 1;
    this._useMixed = this._attachments.attached.length &gt; 1 || (this._alternatives.length &amp;&amp; this._attachments.attached.length ===
1);

    // Compose MIME tree
    if (this.mail.raw) {
        this.message = new BuildMail().setRaw(this.mail.raw);
    } else if (this._useMixed) {
        this.message = this._createMixed();
    } else if (this._useAlternative) {
        this.message = this._createAlternative();
    } else if (this._useRelated) {
        this.message = this._createRelated();
    } else {
        this.message = this._createContentNode(false, [].concat(this._alternatives || []).concat(this._attachments.attached || []).
shift() || {
            contentType: 'text/plain',
            content: ''
        });
    }

    // Add custom headers
    if (this.mail.headers) {
        this.message.addHeader(this.mail.headers);
    }

    // Add headers to the root node, always overrides custom headers
    [
        'from',
        'sender',
        'to',
        'cc',
        'bcc',
        'reply-to',
        'in-reply-to',
        'references',
        'subject',
        'message-id',
        'date'
    ].forEach(function (header) {
        var key = header.replace(/-(\w)/g, function (o, c) {
            return c.toUpperCase();
        });
        if (this.mail[key]) {
            this.message.setHeader(header, this.mail[key]);
        }
    }.bind(this));

    // Sets custom envelope
    if (this.mail.envelope) {
        this.message.setEnvelope(this.mail.envelope);
    }

    // ensure Message-Id value
    this.message.messageId();

    return this.message;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives" id="apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.getAlternatives
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype.getAlternatives = function () {
    var alternatives = [],
        text, html, watchHtml, icalEvent;

    if (this.mail.text) {
        if (typeof this.mail.text === 'object' &amp;&amp; (this.mail.text.content || this.mail.text.path || this.mail.text.href || this.
mail.text.raw)) {
            text = this.mail.text;
        } else {
            text = {
                content: this.mail.text
            };
        }
        text.contentType = 'text/plain' + (!text.encoding &amp;&amp; libmime.isPlainText(text.content) ? '' : '; charset=utf-8');
    }

    if (this.mail.watchHtml) {
        if (typeof this.mail.watchHtml === 'object' &amp;&amp; (this.mail.watchHtml.content || this.mail.watchHtml.path || this.mail.watchHtml
.href || this.mail.watchHtml.raw)) {
            watchHtml = this.mail.watchHtml;
        } else {
            watchHtml = {
                content: this.mail.watchHtml
            };
        }
        watchHtml.contentType = 'text/watch-html' + (!watchHtml.encoding &amp;&amp; libmime.isPlainText(watchHtml.content) ? '' : '; charset
=utf-8');
    }

    if (this.mail.icalEvent) {
        if (typeof this.mail.icalEvent === 'object' &amp;&amp; (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent
.href || this.mail.icalEvent.raw)) {
            icalEvent = this.mail.icalEvent;
        } else {
            icalEvent = {
                content: this.mail.icalEvent
            };
        }
        icalEvent.contentType = 'text/calendar; charset="utf-8"; method=' + (icalEvent.method || 'PUBLISH').toString().trim().toUpperCase
();
        if (!icalEvent.headers) {
            icalEvent.headers = {};
        }
        icalEvent.headers['Content-Transfer-Encoding'] = 'base64';
    }

    if (this.mail.html) {
        if (typeof this.mail.html === 'object' &amp;&amp; (this.mail.html.content || this.mail.html.path || this.mail.html.href || this.
mail.html.raw)) {
            html = this.mail.html;
        } else {
            html = {
                content: this.mail.html
            };
        }
        html.contentType = 'text/html' + (!html.encoding &amp;&amp; libmime.isPlainText(html.content) ? '' : '; charset=utf-8');
    }

    [].
    concat(text || []).
    concat(watchHtml || []).
    concat(html || []).
    concat(icalEvent || []).
    concat(this.mail.alternatives || []).
    forEach(function (alternative) {
        var data;

        if (/^data:/i.test(alternative.path || alternative.href)) {
            alternative = this._processDataUrl(alternative);
        }

        data = {
            contentType: alternative.contentType ||
                libmime.detectMimeType(alternative.filename || alternative.path || alternative.href || 'txt'),
            contentTransferEncoding: alternative.contentTransferEncoding
        };

        if (alternative.filename) {
            data.filename = alternative.filename;
        }

        if (/^https?:\/\//i.test(alternative.path)) {
            alternative.href = alternative.path;
            alternative.path = undefined;
        }

        if (alternative.raw) {
            data.raw = alternative.raw;
        } else if (alternative.path) {
            data.content = {
                path: alternative.path
            };
        } else if (alternative.href) {
            data.content = {
                href: alternative.href
            };
        } else {
            data.content = alternative.content || '';
        }

        if (alternative.encoding) {
            data.encoding = alternative.encoding;
        }

        if (alternative.headers) {
            data.headers = alternative.headers;
        }

        alternatives.push(data);
    }.bind(this));

    return alternatives;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments" id="apidoc.element.mailcomposer.MailComposer.prototype.getAttachments">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer.prototype.getAttachments
        <span class="apidocSignatureSpan">(findRelated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MailComposer.prototype.getAttachments = function (findRelated) {
    var attachments = [].concat(this.mail.attachments || []).map(function (attachment, i) {
        var data;
        var isMessageNode = /^message\//i.test(attachment.contentType);

        if (/^data:/i.test(attachment.path || attachment.href)) {
            attachment = this._processDataUrl(attachment);
        }

        data = {
            contentType: attachment.contentType ||
                libmime.detectMimeType(attachment.filename || attachment.path || attachment.href || 'bin'),
            contentDisposition: attachment.contentDisposition || (isMessageNode ? 'inline' : 'attachment'),
            contentTransferEncoding: attachment.contentTransferEncoding
        };

        if (attachment.filename) {
            data.filename = attachment.filename;
        } else if (!isMessageNode &amp;&amp; attachment.filename !== false) {
            data.filename = (attachment.path || attachment.href || '').split('/').pop() || 'attachment-' + (i + 1);
            if (data.filename.indexOf('.') &lt; 0) {
                data.filename += '.' + libmime.detectExtension(data.contentType);
            }
        }

        if (/^https?:\/\//i.test(attachment.path)) {
            attachment.href = attachment.path;
            attachment.path = undefined;
        }

        if (attachment.cid) {
            data.cid = attachment.cid;
        }

        if (attachment.raw) {
            data.raw = attachment.raw;
        } else if (attachment.path) {
            data.content = {
                path: attachment.path
            };
        } else if (attachment.href) {
            data.content = {
                href: attachment.href
            };
        } else {
            data.content = attachment.content || '';
        }

        if (attachment.encoding) {
            data.encoding = attachment.encoding;
        }

        if (attachment.headers) {
            data.headers = attachment.headers;
        }

        return data;
    }.bind(this));

    if (!findRelated) {
        return {
            attached: attachments,
            related: []
        };
    } else {
        return {
            attached: attachments.filter(function (attachment) {
                return !attachment.cid;
            }),
            related: attachments.filter(function (attachment) {
                return !!attachment.cid;
            })
        };
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.toString" id="apidoc.element.mailcomposer.toString">
        function <span class="apidocSignatureSpan">mailcomposer.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.Gruntfile" id="apidoc.module.mailcomposer.Gruntfile">module mailcomposer.Gruntfile</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.Gruntfile.Gruntfile" id="apidoc.element.mailcomposer.Gruntfile.Gruntfile">
        function <span class="apidocSignatureSpan">mailcomposer.</span>Gruntfile
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Gruntfile = function (grunt) {

    // Project configuration.
    grunt.initConfig({
        eslint: {
            all: ['lib/*.js', 'test/*.js', 'Gruntfile.js']
        },

        mochaTest: {
            all: {
                options: {
                    reporter: 'spec'
                },
                src: ['test/*-test.js']
            }
        }
    });

    // Load the plugin(s)
    grunt.loadNpmTasks('grunt-eslint');
    grunt.loadNpmTasks('grunt-mocha-test');

    // Tasks
    grunt.registerTask('default', ['eslint', 'mochaTest']);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer" id="apidoc.module.mailcomposer.MailComposer">module mailcomposer.MailComposer</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.MailComposer" id="apidoc.element.mailcomposer.MailComposer.MailComposer">
        function <span class="apidocSignatureSpan">mailcomposer.</span>MailComposer
        <span class="apidocSignatureSpan">(mail)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MailComposer(mail) {
    if (!(this instanceof MailComposer)) {
        return new MailComposer(mail);
    }

    this.mail = mail || {};
    this.message = false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype" id="apidoc.module.mailcomposer.MailComposer.prototype">module mailcomposer.MailComposer.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative" id="apidoc.element.mailcomposer.MailComposer.prototype._createAlternative">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createAlternative
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createAlternative = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/alternative', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/alternative', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._alternatives.forEach(function (alternative) {
        if (this._useRelated &amp;&amp; this._htmlNode === alternative) {
            this._createRelated(node);
        } else {
            this._createContentNode(node, alternative);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode" id="apidoc.element.mailcomposer.MailComposer.prototype._createContentNode">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createContentNode
        <span class="apidocSignatureSpan">(parentNode, element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createContentNode = function (parentNode, element) {
    element = element || {};
    element.content = element.content || '';

    var node;
    var encoding = (element.encoding || 'utf8')
        .toString()
        .toLowerCase()
        .replace(/[-_\s]/g, '');

    if (!parentNode) {
        node = new BuildMail(element.contentType, {
            filename: element.filename,
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild(element.contentType, {
            filename: element.filename,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    // add custom headers
    if (element.headers) {
        node.addHeader(element.headers);
    }

    if (element.cid) {
        node.setHeader('Content-Id', '&lt;' + element.cid.replace(/[&lt;&gt;]/g, '') + '&gt;');
    }

    if (element.contentTransferEncoding) {
        node.setHeader('Content-Transfer-Encoding', element.contentTransferEncoding);
    } else if (this.mail.encoding &amp;&amp; /^text\//i.test(element.contentType)) {
        node.setHeader('Content-Transfer-Encoding', this.mail.encoding);
    }

    if (!/^text\//i.test(element.contentType) || element.contentDisposition) {
        node.setHeader('Content-Disposition', element.contentDisposition || (element.cid ? 'inline' : 'attachment'));
    }

    if (typeof element.content === 'string' &amp;&amp; ['utf8', 'usascii', 'ascii'].indexOf(encoding) &lt; 0) {
        element.content = new Buffer(element.content, encoding);
    }

    // prefer pregenerated raw content
    if (element.raw) {
        node.setRaw(element.raw);
    } else {
        node.setContent(element.content);
    }

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed" id="apidoc.element.mailcomposer.MailComposer.prototype._createMixed">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createMixed
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createMixed = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/mixed', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/mixed', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    if (this._useAlternative) {
        this._createAlternative(node);
    } else if (this._useRelated) {
        this._createRelated(node);
    }

    [].concat(!this._useAlternative &amp;&amp; this._alternatives || []).concat(this._attachments.attached || []).forEach(function (element
) {
        // if the element is a html node from related subpart then ignore it
        if (!this._useRelated || element !== this._htmlNode) {
            this._createContentNode(node, element);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated" id="apidoc.element.mailcomposer.MailComposer.prototype._createRelated">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createRelated
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createRelated = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/related; type="text/html"', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/related; type="text/html"', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._createContentNode(node, this._htmlNode);

    this._attachments.related.forEach(function (alternative) {
        this._createContentNode(node, alternative);
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl" id="apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_processDataUrl
        <span class="apidocSignatureSpan">(element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_processDataUrl = function (element) {
    var parts = (element.path || element.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);
    if (!parts) {
        return element;
    }

    element.content = /\bbase64$/i.test(parts[1]) ? new Buffer(parts[2], 'base64') : new Buffer(decodeURIComponent(parts[2]));

    if ('path' in element) {
        element.path = false;
    }

    if ('href' in element) {
        element.href = false;
    }

    parts[1].split(';').forEach(function (item) {
        if (/^\w+\/[^\/]+$/i.test(item)) {
            element.contentType = element.contentType || item.toLowerCase();
        }
    });

    return element;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.compile" id="apidoc.element.mailcomposer.MailComposer.prototype.compile">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>compile
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">compile = function () {
    this._alternatives = this.getAlternatives();
    this._htmlNode = this._alternatives.filter(function (alternative) {
        return /^text\/html\b/i.test(alternative.contentType);
    }).pop();
    this._attachments = this.getAttachments(!!this._htmlNode);

    this._useRelated = !!(this._htmlNode &amp;&amp; this._attachments.related.length);
    this._useAlternative = this._alternatives.length &gt; 1;
    this._useMixed = this._attachments.attached.length &gt; 1 || (this._alternatives.length &amp;&amp; this._attachments.attached.length ===
1);

    // Compose MIME tree
    if (this.mail.raw) {
        this.message = new BuildMail().setRaw(this.mail.raw);
    } else if (this._useMixed) {
        this.message = this._createMixed();
    } else if (this._useAlternative) {
        this.message = this._createAlternative();
    } else if (this._useRelated) {
        this.message = this._createRelated();
    } else {
        this.message = this._createContentNode(false, [].concat(this._alternatives || []).concat(this._attachments.attached || []).
shift() || {
            contentType: 'text/plain',
            content: ''
        });
    }

    // Add custom headers
    if (this.mail.headers) {
        this.message.addHeader(this.mail.headers);
    }

    // Add headers to the root node, always overrides custom headers
    [
        'from',
        'sender',
        'to',
        'cc',
        'bcc',
        'reply-to',
        'in-reply-to',
        'references',
        'subject',
        'message-id',
        'date'
    ].forEach(function (header) {
        var key = header.replace(/-(\w)/g, function (o, c) {
            return c.toUpperCase();
        });
        if (this.mail[key]) {
            this.message.setHeader(header, this.mail[key]);
        }
    }.bind(this));

    // Sets custom envelope
    if (this.mail.envelope) {
        this.message.setEnvelope(this.mail.envelope);
    }

    // ensure Message-Id value
    this.message.messageId();

    return this.message;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives" id="apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAlternatives
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAlternatives = function () {
    var alternatives = [],
        text, html, watchHtml, icalEvent;

    if (this.mail.text) {
        if (typeof this.mail.text === 'object' &amp;&amp; (this.mail.text.content || this.mail.text.path || this.mail.text.href || this.
mail.text.raw)) {
            text = this.mail.text;
        } else {
            text = {
                content: this.mail.text
            };
        }
        text.contentType = 'text/plain' + (!text.encoding &amp;&amp; libmime.isPlainText(text.content) ? '' : '; charset=utf-8');
    }

    if (this.mail.watchHtml) {
        if (typeof this.mail.watchHtml === 'object' &amp;&amp; (this.mail.watchHtml.content || this.mail.watchHtml.path || this.mail.watchHtml
.href || this.mail.watchHtml.raw)) {
            watchHtml = this.mail.watchHtml;
        } else {
            watchHtml = {
                content: this.mail.watchHtml
            };
        }
        watchHtml.contentType = 'text/watch-html' + (!watchHtml.encoding &amp;&amp; libmime.isPlainText(watchHtml.content) ? '' : '; charset
=utf-8');
    }

    if (this.mail.icalEvent) {
        if (typeof this.mail.icalEvent === 'object' &amp;&amp; (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent
.href || this.mail.icalEvent.raw)) {
            icalEvent = this.mail.icalEvent;
        } else {
            icalEvent = {
                content: this.mail.icalEvent
            };
        }
        icalEvent.contentType = 'text/calendar; charset="utf-8"; method=' + (icalEvent.method || 'PUBLISH').toString().trim().toUpperCase
();
        if (!icalEvent.headers) {
            icalEvent.headers = {};
        }
        icalEvent.headers['Content-Transfer-Encoding'] = 'base64';
    }

    if (this.mail.html) {
        if (typeof this.mail.html === 'object' &amp;&amp; (this.mail.html.content || this.mail.html.path || this.mail.html.href || this.
mail.html.raw)) {
            html = this.mail.html;
        } else {
            html = {
                content: this.mail.html
            };
        }
        html.contentType = 'text/html' + (!html.encoding &amp;&amp; libmime.isPlainText(html.content) ? '' : '; charset=utf-8');
    }

    [].
    concat(text || []).
    concat(watchHtml || []).
    concat(html || []).
    concat(icalEvent || []).
    concat(this.mail.alternatives || []).
    forEach(function (alternative) {
        var data;

        if (/^data:/i.test(alternative.path || alternative.href)) {
            alternative = this._processDataUrl(alternative);
        }

        data = {
            contentType: alternative.contentType ||
                libmime.detectMimeType(alternative.filename || alternative.path || alternative.href || 'txt'),
            contentTransferEncoding: alternative.contentTransferEncoding
        };

        if (alternative.filename) {
            data.filename = alternative.filename;
        }

        if (/^https?:\/\//i.test(alternative.path)) {
            alternative.href = alternative.path;
            alternative.path = undefined;
        }

        if (alternative.raw) {
            data.raw = alternative.raw;
        } else if (alternative.path) {
            data.content = {
                path: alternative.path
            };
        } else if (alternative.href) {
            data.content = {
                href: alternative.href
            };
        } else {
            data.content = alternative.content || '';
        }

        if (alternative.encoding) {
            data.encoding = alternative.encoding;
        }

        if (alternative.headers) {
            data.headers = alternative.headers;
        }

        alternatives.push(data);
    }.bind(this));

    return alternatives;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments" id="apidoc.element.mailcomposer.MailComposer.prototype.getAttachments">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAttachments
        <span class="apidocSignatureSpan">(findRelated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAttachments = function (findRelated) {
    var attachments = [].concat(this.mail.attachments || []).map(function (attachment, i) {
        var data;
        var isMessageNode = /^message\//i.test(attachment.contentType);

        if (/^data:/i.test(attachment.path || attachment.href)) {
            attachment = this._processDataUrl(attachment);
        }

        data = {
            contentType: attachment.contentType ||
                libmime.detectMimeType(attachment.filename || attachment.path || attachment.href || 'bin'),
            contentDisposition: attachment.contentDisposition || (isMessageNode ? 'inline' : 'attachment'),
            contentTransferEncoding: attachment.contentTransferEncoding
        };

        if (attachment.filename) {
            data.filename = attachment.filename;
        } else if (!isMessageNode &amp;&amp; attachment.filename !== false) {
            data.filename = (attachment.path || attachment.href || '').split('/').pop() || 'attachment-' + (i + 1);
            if (data.filename.indexOf('.') &lt; 0) {
                data.filename += '.' + libmime.detectExtension(data.contentType);
            }
        }

        if (/^https?:\/\//i.test(attachment.path)) {
            attachment.href = attachment.path;
            attachment.path = undefined;
        }

        if (attachment.cid) {
            data.cid = attachment.cid;
        }

        if (attachment.raw) {
            data.raw = attachment.raw;
        } else if (attachment.path) {
            data.content = {
                path: attachment.path
            };
        } else if (attachment.href) {
            data.content = {
                href: attachment.href
            };
        } else {
            data.content = attachment.content || '';
        }

        if (attachment.encoding) {
            data.encoding = attachment.encoding;
        }

        if (attachment.headers) {
            data.headers = attachment.headers;
        }

        return data;
    }.bind(this));

    if (!findRelated) {
        return {
            attached: attachments,
            related: []
        };
    } else {
        return {
            attached: attachments.filter(function (attachment) {
                return !attachment.cid;
            }),
            related: attachments.filter(function (attachment) {
                return !!attachment.cid;
            })
        };
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createAlternative" id="apidoc.module.mailcomposer.MailComposer.prototype._createAlternative">module mailcomposer.MailComposer.prototype._createAlternative</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createAlternative._createAlternative" id="apidoc.element.mailcomposer.MailComposer.prototype._createAlternative._createAlternative">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createAlternative
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createAlternative = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/alternative', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/alternative', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._alternatives.forEach(function (alternative) {
        if (this._useRelated &amp;&amp; this._htmlNode === alternative) {
            this._createRelated(node);
        } else {
            this._createContentNode(node, alternative);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createContentNode" id="apidoc.module.mailcomposer.MailComposer.prototype._createContentNode">module mailcomposer.MailComposer.prototype._createContentNode</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createContentNode._createContentNode" id="apidoc.element.mailcomposer.MailComposer.prototype._createContentNode._createContentNode">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createContentNode
        <span class="apidocSignatureSpan">(parentNode, element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createContentNode = function (parentNode, element) {
    element = element || {};
    element.content = element.content || '';

    var node;
    var encoding = (element.encoding || 'utf8')
        .toString()
        .toLowerCase()
        .replace(/[-_\s]/g, '');

    if (!parentNode) {
        node = new BuildMail(element.contentType, {
            filename: element.filename,
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild(element.contentType, {
            filename: element.filename,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    // add custom headers
    if (element.headers) {
        node.addHeader(element.headers);
    }

    if (element.cid) {
        node.setHeader('Content-Id', '&lt;' + element.cid.replace(/[&lt;&gt;]/g, '') + '&gt;');
    }

    if (element.contentTransferEncoding) {
        node.setHeader('Content-Transfer-Encoding', element.contentTransferEncoding);
    } else if (this.mail.encoding &amp;&amp; /^text\//i.test(element.contentType)) {
        node.setHeader('Content-Transfer-Encoding', this.mail.encoding);
    }

    if (!/^text\//i.test(element.contentType) || element.contentDisposition) {
        node.setHeader('Content-Disposition', element.contentDisposition || (element.cid ? 'inline' : 'attachment'));
    }

    if (typeof element.content === 'string' &amp;&amp; ['utf8', 'usascii', 'ascii'].indexOf(encoding) &lt; 0) {
        element.content = new Buffer(element.content, encoding);
    }

    // prefer pregenerated raw content
    if (element.raw) {
        node.setRaw(element.raw);
    } else {
        node.setContent(element.content);
    }

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createMixed" id="apidoc.module.mailcomposer.MailComposer.prototype._createMixed">module mailcomposer.MailComposer.prototype._createMixed</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createMixed._createMixed" id="apidoc.element.mailcomposer.MailComposer.prototype._createMixed._createMixed">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createMixed
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createMixed = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/mixed', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/mixed', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    if (this._useAlternative) {
        this._createAlternative(node);
    } else if (this._useRelated) {
        this._createRelated(node);
    }

    [].concat(!this._useAlternative &amp;&amp; this._alternatives || []).concat(this._attachments.attached || []).forEach(function (element
) {
        // if the element is a html node from related subpart then ignore it
        if (!this._useRelated || element !== this._htmlNode) {
            this._createContentNode(node, element);
        }
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype._createRelated" id="apidoc.module.mailcomposer.MailComposer.prototype._createRelated">module mailcomposer.MailComposer.prototype._createRelated</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._createRelated._createRelated" id="apidoc.element.mailcomposer.MailComposer.prototype._createRelated._createRelated">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_createRelated
        <span class="apidocSignatureSpan">(parentNode)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createRelated = function (parentNode) {
    var node;

    if (!parentNode) {
        node = new BuildMail('multipart/related; type="text/html"', {
            baseBoundary: this.mail.baseBoundary,
            textEncoding: this.mail.textEncoding,
            boundaryPrefix: this.mail.boundaryPrefix,
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    } else {
        node = parentNode.createChild('multipart/related; type="text/html"', {
            disableUrlAccess: this.mail.disableUrlAccess,
            disableFileAccess: this.mail.disableFileAccess
        });
    }

    this._createContentNode(node, this._htmlNode);

    this._attachments.related.forEach(function (alternative) {
        this._createContentNode(node, alternative);
    }.bind(this));

    return node;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype._processDataUrl" id="apidoc.module.mailcomposer.MailComposer.prototype._processDataUrl">module mailcomposer.MailComposer.prototype._processDataUrl</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl._processDataUrl" id="apidoc.element.mailcomposer.MailComposer.prototype._processDataUrl._processDataUrl">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>_processDataUrl
        <span class="apidocSignatureSpan">(element)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_processDataUrl = function (element) {
    var parts = (element.path || element.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);
    if (!parts) {
        return element;
    }

    element.content = /\bbase64$/i.test(parts[1]) ? new Buffer(parts[2], 'base64') : new Buffer(decodeURIComponent(parts[2]));

    if ('path' in element) {
        element.path = false;
    }

    if ('href' in element) {
        element.href = false;
    }

    parts[1].split(';').forEach(function (item) {
        if (/^\w+\/[^\/]+$/i.test(item)) {
            element.contentType = element.contentType || item.toLowerCase();
        }
    });

    return element;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype.compile" id="apidoc.module.mailcomposer.MailComposer.prototype.compile">module mailcomposer.MailComposer.prototype.compile</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.compile.compile" id="apidoc.element.mailcomposer.MailComposer.prototype.compile.compile">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>compile
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">compile = function () {
    this._alternatives = this.getAlternatives();
    this._htmlNode = this._alternatives.filter(function (alternative) {
        return /^text\/html\b/i.test(alternative.contentType);
    }).pop();
    this._attachments = this.getAttachments(!!this._htmlNode);

    this._useRelated = !!(this._htmlNode &amp;&amp; this._attachments.related.length);
    this._useAlternative = this._alternatives.length &gt; 1;
    this._useMixed = this._attachments.attached.length &gt; 1 || (this._alternatives.length &amp;&amp; this._attachments.attached.length ===
1);

    // Compose MIME tree
    if (this.mail.raw) {
        this.message = new BuildMail().setRaw(this.mail.raw);
    } else if (this._useMixed) {
        this.message = this._createMixed();
    } else if (this._useAlternative) {
        this.message = this._createAlternative();
    } else if (this._useRelated) {
        this.message = this._createRelated();
    } else {
        this.message = this._createContentNode(false, [].concat(this._alternatives || []).concat(this._attachments.attached || []).
shift() || {
            contentType: 'text/plain',
            content: ''
        });
    }

    // Add custom headers
    if (this.mail.headers) {
        this.message.addHeader(this.mail.headers);
    }

    // Add headers to the root node, always overrides custom headers
    [
        'from',
        'sender',
        'to',
        'cc',
        'bcc',
        'reply-to',
        'in-reply-to',
        'references',
        'subject',
        'message-id',
        'date'
    ].forEach(function (header) {
        var key = header.replace(/-(\w)/g, function (o, c) {
            return c.toUpperCase();
        });
        if (this.mail[key]) {
            this.message.setHeader(header, this.mail[key]);
        }
    }.bind(this));

    // Sets custom envelope
    if (this.mail.envelope) {
        this.message.setEnvelope(this.mail.envelope);
    }

    // ensure Message-Id value
    this.message.messageId();

    return this.message;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype.getAlternatives" id="apidoc.module.mailcomposer.MailComposer.prototype.getAlternatives">module mailcomposer.MailComposer.prototype.getAlternatives</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives.getAlternatives" id="apidoc.element.mailcomposer.MailComposer.prototype.getAlternatives.getAlternatives">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAlternatives
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAlternatives = function () {
    var alternatives = [],
        text, html, watchHtml, icalEvent;

    if (this.mail.text) {
        if (typeof this.mail.text === 'object' &amp;&amp; (this.mail.text.content || this.mail.text.path || this.mail.text.href || this.
mail.text.raw)) {
            text = this.mail.text;
        } else {
            text = {
                content: this.mail.text
            };
        }
        text.contentType = 'text/plain' + (!text.encoding &amp;&amp; libmime.isPlainText(text.content) ? '' : '; charset=utf-8');
    }

    if (this.mail.watchHtml) {
        if (typeof this.mail.watchHtml === 'object' &amp;&amp; (this.mail.watchHtml.content || this.mail.watchHtml.path || this.mail.watchHtml
.href || this.mail.watchHtml.raw)) {
            watchHtml = this.mail.watchHtml;
        } else {
            watchHtml = {
                content: this.mail.watchHtml
            };
        }
        watchHtml.contentType = 'text/watch-html' + (!watchHtml.encoding &amp;&amp; libmime.isPlainText(watchHtml.content) ? '' : '; charset
=utf-8');
    }

    if (this.mail.icalEvent) {
        if (typeof this.mail.icalEvent === 'object' &amp;&amp; (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent
.href || this.mail.icalEvent.raw)) {
            icalEvent = this.mail.icalEvent;
        } else {
            icalEvent = {
                content: this.mail.icalEvent
            };
        }
        icalEvent.contentType = 'text/calendar; charset="utf-8"; method=' + (icalEvent.method || 'PUBLISH').toString().trim().toUpperCase
();
        if (!icalEvent.headers) {
            icalEvent.headers = {};
        }
        icalEvent.headers['Content-Transfer-Encoding'] = 'base64';
    }

    if (this.mail.html) {
        if (typeof this.mail.html === 'object' &amp;&amp; (this.mail.html.content || this.mail.html.path || this.mail.html.href || this.
mail.html.raw)) {
            html = this.mail.html;
        } else {
            html = {
                content: this.mail.html
            };
        }
        html.contentType = 'text/html' + (!html.encoding &amp;&amp; libmime.isPlainText(html.content) ? '' : '; charset=utf-8');
    }

    [].
    concat(text || []).
    concat(watchHtml || []).
    concat(html || []).
    concat(icalEvent || []).
    concat(this.mail.alternatives || []).
    forEach(function (alternative) {
        var data;

        if (/^data:/i.test(alternative.path || alternative.href)) {
            alternative = this._processDataUrl(alternative);
        }

        data = {
            contentType: alternative.contentType ||
                libmime.detectMimeType(alternative.filename || alternative.path || alternative.href || 'txt'),
            contentTransferEncoding: alternative.contentTransferEncoding
        };

        if (alternative.filename) {
            data.filename = alternative.filename;
        }

        if (/^https?:\/\//i.test(alternative.path)) {
            alternative.href = alternative.path;
            alternative.path = undefined;
        }

        if (alternative.raw) {
            data.raw = alternative.raw;
        } else if (alternative.path) {
            data.content = {
                path: alternative.path
            };
        } else if (alternative.href) {
            data.content = {
                href: alternative.href
            };
        } else {
            data.content = alternative.content || '';
        }

        if (alternative.encoding) {
            data.encoding = alternative.encoding;
        }

        if (alternative.headers) {
            data.headers = alternative.headers;
        }

        alternatives.push(data);
    }.bind(this));

    return alternatives;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.MailComposer.prototype.getAttachments" id="apidoc.module.mailcomposer.MailComposer.prototype.getAttachments">module mailcomposer.MailComposer.prototype.getAttachments</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.MailComposer.prototype.getAttachments.getAttachments" id="apidoc.element.mailcomposer.MailComposer.prototype.getAttachments.getAttachments">
        function <span class="apidocSignatureSpan">mailcomposer.MailComposer.prototype.</span>getAttachments
        <span class="apidocSignatureSpan">(findRelated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getAttachments = function (findRelated) {
    var attachments = [].concat(this.mail.attachments || []).map(function (attachment, i) {
        var data;
        var isMessageNode = /^message\//i.test(attachment.contentType);

        if (/^data:/i.test(attachment.path || attachment.href)) {
            attachment = this._processDataUrl(attachment);
        }

        data = {
            contentType: attachment.contentType ||
                libmime.detectMimeType(attachment.filename || attachment.path || attachment.href || 'bin'),
            contentDisposition: attachment.contentDisposition || (isMessageNode ? 'inline' : 'attachment'),
            contentTransferEncoding: attachment.contentTransferEncoding
        };

        if (attachment.filename) {
            data.filename = attachment.filename;
        } else if (!isMessageNode &amp;&amp; attachment.filename !== false) {
            data.filename = (attachment.path || attachment.href || '').split('/').pop() || 'attachment-' + (i + 1);
            if (data.filename.indexOf('.') &lt; 0) {
                data.filename += '.' + libmime.detectExtension(data.contentType);
            }
        }

        if (/^https?:\/\//i.test(attachment.path)) {
            attachment.href = attachment.path;
            attachment.path = undefined;
        }

        if (attachment.cid) {
            data.cid = attachment.cid;
        }

        if (attachment.raw) {
            data.raw = attachment.raw;
        } else if (attachment.path) {
            data.content = {
                path: attachment.path
            };
        } else if (attachment.href) {
            data.content = {
                href: attachment.href
            };
        } else {
            data.content = attachment.content || '';
        }

        if (attachment.encoding) {
            data.encoding = attachment.encoding;
        }

        if (attachment.headers) {
            data.headers = attachment.headers;
        }

        return data;
    }.bind(this));

    if (!findRelated) {
        return {
            attached: attachments,
            related: []
        };
    } else {
        return {
            attached: attachments.filter(function (attachment) {
                return !attachment.cid;
            }),
            related: attachments.filter(function (attachment) {
                return !!attachment.cid;
            })
        };
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.mailcomposer.toString" id="apidoc.module.mailcomposer.toString">module mailcomposer.toString</a></h1>


    <h2>
        <a href="#apidoc.element.mailcomposer.toString.toString" id="apidoc.element.mailcomposer.toString.toString">
        function <span class="apidocSignatureSpan">mailcomposer.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>